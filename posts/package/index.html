<!doctype html>
<html lang="en">
  <head>
    <title>iOS脚本打包 // Whde</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.55.6" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Whde" />
    <meta name="description" content="iOS脚本打包" />
    <link rel="stylesheet" href="https://whde.github.io/css/main.min.280093df0016aa5a8a32bd0943f5856c3372e631ca932fbaf43a52fdc26ab07c.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="iOS脚本打包"/>
<meta name="twitter:description" content="iOS脚本打包"/>

    <meta property="og:title" content="iOS脚本打包" />
<meta property="og:description" content="iOS脚本打包" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://whde.github.io/posts/package/" />
<meta property="article:published_time" content="2017-12-14T11:18:15&#43;08:00"/>
<meta property="article:modified_time" content="2017-12-14T11:18:15&#43;08:00"/>


  </head>
  <body>
    <header class="app-header">
      <a href="https://whde.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Whde" /></a>
      <h1>Whde</h1>
      <p>You copied this work off Piter, because you&#39;ve made exactly the Same Mistakes.</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/Whde"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">iOS脚本打包</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 14, 2017
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://whde.github.io/tags/package/">Package</a><a class="tag" href="https://whde.github.io/tags/ios/">iOS</a></div></div>
    </header>
    <div class="post-content">
      

<h1 id="ios脚本打包">iOS脚本打包</h1>

<h3 id="使用方法">使用方法</h3>

<ul>
<li><p>项目主目录下创建 Package 文件夹, 将Package_test.sh DevelopmentExportOptionsPlist.plist放进文件下</p></li>

<li><p>打开Package_test.sh文件,修改 &ldquo;项目自定义部分&rdquo; 配置好项目参数</p></li>

<li><p>打开DevelopmentExportOptionsPlist.plist, 配置provisioningProfiles字段</p></li>

<li><p>打开终端, cd到Package文件夹</p></li>

<li><p>输入 sh Package_test.sh 命令,回车,开始执行此打包脚本</p></li>
</ul>

<h3 id="developmentexportoptionsplist-plist">DevelopmentExportOptionsPlist.plist</h3>

<p>文件下载地址：<a href="/files/DevelopmentExportOptionsPlist.plist" download="DevelopmentExportOptionsPlist.plist">DevelopmentExportOptionsPlist.plist</a></p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
	&lt;key&gt;compileBitcode&lt;/key&gt;
	&lt;false/&gt;
	&lt;key&gt;method&lt;/key&gt;
	&lt;string&gt;development&lt;/string&gt;
	&lt;key&gt;provisioningProfiles&lt;/key&gt;
	&lt;dict&gt;
		&lt;key&gt;com.Whde.WhdeProjectName&lt;/key&gt;
		&lt;string&gt;Wildcard&lt;/string&gt;
	&lt;/dict&gt;
	&lt;key&gt;signingCertificate&lt;/key&gt;
	&lt;string&gt;iPhone Developer&lt;/string&gt;
	&lt;key&gt;signingStyle&lt;/key&gt;
	&lt;string&gt;manual&lt;/string&gt;
	&lt;key&gt;stripSwiftSymbols&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;teamID&lt;/key&gt;
	&lt;string&gt;BVU65MZFLK&lt;/string&gt;
	&lt;key&gt;thinning&lt;/key&gt;
	&lt;string&gt;&amp;lt;none&amp;gt;&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;

</code></pre>

<h3 id="package-test-sh">Package_test.sh</h3>

<p>文件下载地址：<a href="/files/Package_test.sh" download="Package_test.sh">Package_test.sh</a></p>

<pre><code class="language-shell"># !/bin/bash

# 使用方法:
# 1 : 项目主目录下创建 Package 文件夹, 将Package_test.sh DevelopmentExportOptionsPlist.plist放进文件下
# 2 : 打开Package_test.sh文件,修改 &quot;项目自定义部分&quot; 配置好项目参数
# 3 : 打开DevelopmentExportOptionsPlist.plist, 配置provisioningProfiles字段
# 4 : 打开终端, cd到Package文件夹
# 5 : 输入 sh Package_test.sh 命令,回车,开始执行此打包脚本

# ===============================项目自定义部分(自定义好下列参数后再执行该脚本)============================= #
# 计时
SECONDS=0
# 是否编译工作空间 (例:若是用Cocopods管理的.xcworkspace项目,赋值true;用Xcode默认创建的.xcodeproj,赋值false)
is_workspace=&quot;true&quot;
# 指定项目的scheme名称
scheme_name=&quot;WhdeProjectName&quot;
# 工程中Target对应的配置plist文件名称, Xcode默认的配置文件为Info.plist
info_plist_name=&quot;Info&quot;
# 指定要打包编译的方式 : Release,Debug...
build_configuration=&quot;Release&quot;


# ===============================自动打包部分(无特殊情况不用修改)============================= #
# 导出ipa所需要的plist文件路径 
ExportOptionsPlistPath=&quot;./Package/DevelopmentExportOptionsPlist.plist&quot;
# 返回上一级目录,进入项目工程目录
cd ..
# 获取项目名称
project_name=`find . -name *.xcodeproj | awk -F &quot;[/.]&quot; '{print $(NF-1)}'`
# 获取版本号,内部版本号,bundleID
info_plist_path=&quot;$project_name/Default/$info_plist_name.plist&quot;
/usr/libexec/PlistBuddy -c &quot;Set :CFBundleIdentifier com.Whde.WhdeProjectName&quot; &quot;$info_plist_path&quot;
buildNumber=$(/usr/libexec/PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$info_plist_path&quot;)
buildNumber=$(($buildNumber + 1))
/usr/libexec/PlistBuddy -c &quot;Set :CFBundleVersion $buildNumber&quot; &quot;$info_plist_path&quot;
/usr/libexec/PlistBuddy -c &quot;Set :CFBundleDisplayName Test($buildNumber)&quot; &quot;$info_plist_path&quot;
bundle_version=`/usr/libexec/PlistBuddy -c &quot;Print CFBundleShortVersionString&quot; $info_plist_path`
bundle_build_version=`/usr/libexec/PlistBuddy -c &quot;Print CFBundleVersion&quot; $info_plist_path`
bundle_identifier=`/usr/libexec/PlistBuddy -c &quot;Print CFBundleIdentifier&quot; $info_plist_path`

# 删除旧.xcarchive文件
rm -rf ./Package/$scheme_name.xcarchive
rm -rf ./Package/$scheme_name.ipa
# 指定输出ipa路径
export_path=./Package
# 指定输出归档文件地址
export_archive_path=&quot;$export_path/$scheme_name.xcarchive&quot;
# 指定输出ipa地址
export_ipa_path=&quot;$export_path&quot;
# 指定输出ipa名称 : scheme_name + bundle_version
ipa_name=&quot;$scheme_name&quot;&quot;_V$bundle_version($bundle_build_version)&quot;


echo &quot;\033[32m*************************  开始构建项目  *************************  \033[0m&quot;
# 指定输出文件目录不存在则创建
if [ -d &quot;$export_path&quot; ] ; then
echo $export_path
else
mkdir -pv $export_path
fi

# 判断编译的项目类型是workspace还是project
if $is_workspace ; then
# 编译前清理工程
xcodebuild clean -workspace ${project_name}.xcworkspace \
                 -scheme ${scheme_name} \
                 -configuration ${build_configuration}

xcodebuild archive -workspace ${project_name}.xcworkspace \
                   -scheme ${scheme_name} \
                   -configuration ${build_configuration} \
                   -archivePath ${export_archive_path}
else
# 编译前清理工程
xcodebuild clean -project ${project_name}.xcodeproj \
                 -scheme ${scheme_name} \
                 -configuration ${build_configuration}

xcodebuild archive -project ${project_name}.xcodeproj \
                   -scheme ${scheme_name} \
                   -configuration ${build_configuration} \
                   -archivePath ${export_archive_path}
fi

#  检查是否构建成功
#  xcarchive 实际是一个文件夹不是一个文件所以使用 -d 判断
if [ -d &quot;$export_archive_path&quot; ] ; then
echo &quot;\033[32;1m项目构建成功 \033[0m&quot;
else
echo &quot;\033[31;1m项目构建失败 \033[0m&quot;
exit 1
fi

echo &quot;\033[32m*************************  开始导出ipa文件  *************************  \033[0m&quot;
xcodebuild  -exportArchive \
            -archivePath ${export_archive_path} \
            -exportPath ${export_ipa_path} \
            -exportOptionsPlist ${ExportOptionsPlistPath}
# 修改ipa文件名称
mv $export_ipa_path/$scheme_name.ipa $export_ipa_path/$ipa_name.ipa

# 检查文件是否存在
if [ -f &quot;$export_ipa_path/$ipa_name.ipa&quot; ] ; then
echo &quot;\033[32;1m导出 ${ipa_name}.ipa 包成功 \033[0m&quot;
# open $export_path
else
echo &quot;\033[31;1m导出 ${ipa_name}.ipa 包失败  \033[0m&quot;
exit 1
fi

# 输出打包总用时
echo &quot;\033[36;1m打包总用时: ${SECONDS}s \033[0m&quot;
</code></pre>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
