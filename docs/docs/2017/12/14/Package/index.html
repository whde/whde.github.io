<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Whde"><link rel="alternative" href="/atom.xml" title="Whde" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>iOS脚本打包 - Whde</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">Whde</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2017-12-13T19:18:15.000Z">2017 - 12 - 14 03:18:15</time><h1 class="post__title"><a href="/2017/12/14/Package/">iOS脚本打包</a></h1><div class="post__main echo"><h1 id="iOS脚本打包"><a href="#iOS脚本打包" class="headerlink" title="iOS脚本打包"></a>iOS脚本打包</h1><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li><p>项目主目录下创建 Package 文件夹, 将Package_test.sh DevelopmentExportOptionsPlist.plist放进文件下</p>
</li>
<li><p>打开Package_test.sh文件,修改 “项目自定义部分” 配置好项目参数</p>
</li>
<li><p>打开DevelopmentExportOptionsPlist.plist, 配置provisioningProfiles字段</p>
</li>
<li><p>打开终端, cd到Package文件夹</p>
</li>
<li><p>输入 sh Package_test.sh 命令,回车,开始执行此打包脚本</p>
</li>
</ul>
<h3 id="DevelopmentExportOptionsPlist-plist"><a href="#DevelopmentExportOptionsPlist-plist" class="headerlink" title="DevelopmentExportOptionsPlist.plist"></a>DevelopmentExportOptionsPlist.plist</h3><p>文件下载地址：<a href="/files/DevelopmentExportOptionsPlist.plist" download="DevelopmentExportOptionsPlist.plist">DevelopmentExportOptionsPlist.plist</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>compileBitcode<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>method<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>development<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>provisioningProfiles<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.Whde.WhdeProjectName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>Wildcard<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>signingCertificate<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>iPhone Developer<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>signingStyle<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>manual<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>stripSwiftSymbols<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>teamID<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>BVU65MZFLK<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>thinning<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>&amp;lt;none&amp;gt;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Package-test-sh"><a href="#Package-test-sh" class="headerlink" title="Package_test.sh"></a>Package_test.sh</h3><p>文件下载地址：<a href="/files/Package_test.sh" download="Package_test.sh">Package_test.sh</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> !/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用方法:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 : 项目主目录下创建 Package 文件夹, 将Package_test.sh DevelopmentExportOptionsPlist.plist放进文件下</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2 : 打开Package_test.sh文件,修改 <span class="string">"项目自定义部分"</span> 配置好项目参数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 : 打开DevelopmentExportOptionsPlist.plist, 配置provisioningProfiles字段</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 : 打开终端, <span class="built_in">cd</span>到Package文件夹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5 : 输入 sh Package_test.sh 命令,回车,开始执行此打包脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ===============================项目自定义部分(自定义好下列参数后再执行该脚本)============================= <span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 计时</span></span><br><span class="line">SECONDS=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 是否编译工作空间 (例:若是用Cocopods管理的.xcworkspace项目,赋值<span class="literal">true</span>;用Xcode默认创建的.xcodeproj,赋值<span class="literal">false</span>)</span></span><br><span class="line">is_workspace="true"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定项目的scheme名称</span></span><br><span class="line">scheme_name="WhdeProjectName"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 工程中Target对应的配置plist文件名称, Xcode默认的配置文件为Info.plist</span></span><br><span class="line">info_plist_name="Info"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定要打包编译的方式 : Release,Debug...</span></span><br><span class="line">build_configuration="Release"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ===============================自动打包部分(无特殊情况不用修改)============================= <span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导出ipa所需要的plist文件路径 </span></span><br><span class="line">ExportOptionsPlistPath="./Package/DevelopmentExportOptionsPlist.plist"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回上一级目录,进入项目工程目录</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取项目名称</span></span><br><span class="line">project_name=`find . -name *.xcodeproj | awk -F "[/.]" '&#123;print $(NF-1)&#125;'`</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取版本号,内部版本号,bundleID</span></span><br><span class="line">info_plist_path="$project_name/Default/$info_plist_name.plist"</span><br><span class="line">/usr/libexec/PlistBuddy -c "Set :CFBundleIdentifier com.Whde.WhdeProjectName" "$info_plist_path"</span><br><span class="line">buildNumber=$(/usr/libexec/PlistBuddy -c "Print CFBundleVersion" "$info_plist_path")</span><br><span class="line">buildNumber=$(($buildNumber + 1))</span><br><span class="line">/usr/libexec/PlistBuddy -c "Set :CFBundleVersion $buildNumber" "$info_plist_path"</span><br><span class="line">/usr/libexec/PlistBuddy -c "Set :CFBundleDisplayName Test($buildNumber)" "$info_plist_path"</span><br><span class="line">bundle_version=`/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" $info_plist_path`</span><br><span class="line">bundle_build_version=`/usr/libexec/PlistBuddy -c "Print CFBundleVersion" $info_plist_path`</span><br><span class="line">bundle_identifier=`/usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" $info_plist_path`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除旧.xcarchive文件</span></span><br><span class="line">rm -rf ./Package/$scheme_name.xcarchive</span><br><span class="line">rm -rf ./Package/$scheme_name.ipa</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出ipa路径</span></span><br><span class="line">export_path=./Package</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出归档文件地址</span></span><br><span class="line">export_archive_path="$export_path/$scheme_name.xcarchive"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出ipa地址</span></span><br><span class="line">export_ipa_path="$export_path"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出ipa名称 : scheme_name + bundle_version</span></span><br><span class="line">ipa_name="$scheme_name""_V$bundle_version($bundle_build_version)"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo "\033[32m*************************  开始构建项目  *************************  \033[0m"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定输出文件目录不存在则创建</span></span><br><span class="line">if [ -d "$export_path" ] ; then</span><br><span class="line">echo $export_path</span><br><span class="line">else</span><br><span class="line">mkdir -pv $export_path</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断编译的项目类型是workspace还是project</span></span><br><span class="line">if $is_workspace ; then</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译前清理工程</span></span><br><span class="line">xcodebuild clean -workspace $&#123;project_name&#125;.xcworkspace \</span><br><span class="line">                 -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                 -configuration $&#123;build_configuration&#125;</span><br><span class="line"></span><br><span class="line">xcodebuild archive -workspace $&#123;project_name&#125;.xcworkspace \</span><br><span class="line">                   -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                   -configuration $&#123;build_configuration&#125; \</span><br><span class="line">                   -archivePath $&#123;export_archive_path&#125;</span><br><span class="line">else</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译前清理工程</span></span><br><span class="line">xcodebuild clean -project $&#123;project_name&#125;.xcodeproj \</span><br><span class="line">                 -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                 -configuration $&#123;build_configuration&#125;</span><br><span class="line"></span><br><span class="line">xcodebuild archive -project $&#123;project_name&#125;.xcodeproj \</span><br><span class="line">                   -scheme $&#123;scheme_name&#125; \</span><br><span class="line">                   -configuration $&#123;build_configuration&#125; \</span><br><span class="line">                   -archivePath $&#123;export_archive_path&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  检查是否构建成功</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  xcarchive 实际是一个文件夹不是一个文件所以使用 -d 判断</span></span><br><span class="line">if [ -d "$export_archive_path" ] ; then</span><br><span class="line">echo "\033[32;1m项目构建成功 \033[0m"</span><br><span class="line">else</span><br><span class="line">echo "\033[31;1m项目构建失败 \033[0m"</span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo "\033[32m*************************  开始导出ipa文件  *************************  \033[0m"</span><br><span class="line">xcodebuild  -exportArchive \</span><br><span class="line">            -archivePath $&#123;export_archive_path&#125; \</span><br><span class="line">            -exportPath $&#123;export_ipa_path&#125; \</span><br><span class="line">            -exportOptionsPlist $&#123;ExportOptionsPlistPath&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改ipa文件名称</span></span><br><span class="line">mv $export_ipa_path/$scheme_name.ipa $export_ipa_path/$ipa_name.ipa</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查文件是否存在</span></span><br><span class="line">if [ -f "$export_ipa_path/$ipa_name.ipa" ] ; then</span><br><span class="line">echo "\033[32;1m导出 $&#123;ipa_name&#125;.ipa 包成功 \033[0m"</span><br><span class="line"><span class="meta">#</span><span class="bash"> open <span class="variable">$export_path</span></span></span><br><span class="line">else</span><br><span class="line">echo "\033[31;1m导出 $&#123;ipa_name&#125;.ipa 包失败  \033[0m"</span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出打包总用时</span></span><br><span class="line">echo "\033[36;1m打包总用时: $&#123;SECONDS&#125;s \033[0m"</span><br></pre></td></tr></table></figure>

</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/iOS/">iOS</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/Package/">Package</a></li></ul></footer></article></main><footer class="foot"><div class="foot-copy">&copy; 2016 - 2019 Whde</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>